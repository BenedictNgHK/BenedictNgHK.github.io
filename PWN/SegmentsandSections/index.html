<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Segments and Sections | Benedict's Blog</title><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/highlights/rainbow.css"><link rel="canonical" href="https://benedictnghk.github.io/PWN/SegmentsandSections/"/>
<meta name="description" content="SegmentsSegments usually describe the layout of .elf files in memory. In a C program the memory layout is as follows:  So each the…">
<meta property="og:type" content="article">
<meta property="og:title" content="Segments and Sections">
<meta property="og:url" content="https://benedictnghk.github.io/PWN/SegmentsandSections/">
<meta property="og:site_name" content="Benedict&#39;s Blog">
<meta property="og:description" content="SegmentsSegments usually describe the layout of .elf files in memory. In a C program the memory layout is as follows:  So each the…">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://benedictnghk.github.io/PWN/SegmentsandSections/memoryLayoutC.jpg">
<meta property="article:published_time" content="2024-09-06T15:46:47.734Z">
<meta property="article:modified_time" content="2024-09-06T15:46:57.201Z">
<meta property="article:author" content="Benedict Ng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://benedictnghk.github.io/PWN/SegmentsandSections/memoryLayoutC.jpg"><meta property="article:author" content="https://www.facebook.com/BenedictNgYuzeWu"><meta property="twitter:label1" content="Published at"><meta property="twitter:data1" content="2024-09-06 23:46:47"><meta property="twitter:label2" content="Written by"><meta property="twitter:data2" content="Benedict Ng"><link rel="icon" href="/images/icon.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-3WGY09S1RR"></script><script><!-- Google tag (gtag.js) -->
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-3WGY09S1RR');</script><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="https://schema.org/WebPage"><nav class="menu" id="menu"><div class="menu-inner"><div class="menu__left-area"><div class="menu__item"><a class="menu__item__link menu__item__link--brand" href="/" title="Home" rel="home"><img class="menu__item__link--brand__image" src="/images/icon.png" alt="Benedict's Blog"><span class="menu__item__link--brand__label">Benedict's Blog</span></a></div></div><div class="menu__right-area"><div class="menu__item"><a class="menu__item__link" href="/">Posts</a></div><div class="menu__item"><a class="menu__item__link" href="/sitemap/">Sitemap</a></div><div class="menu__item"><a class="menu__item__link" target="_blank" rel="noopener" href="https://github.com/BenedictNgHK">Github</a></div><div class="menu__item"><a class="menu__item__link" href="mailto:yuzewuchina@outlook.com">Email</a></div><div class="menu__item"><a class="menu__item__link" href="/friendlinks/">Friend Links</a></div></div></div></nav><div class="page-background"></div><div class="content-container"><div class="content-outer"><div class="content-inner" itemscope itemtype="https://schema.org/Blog"><article class="article" id="article" itemscope itemtype="https://schema.org/BlogPosting"><h1 class="article__title" itemprop="headline">Segments and Sections</h1><div class="article__meta"><time class="article__meta__time" datetime="2024-09-06T15:46:47.734Z" itemprop="datePublished">2024-09-06 23:46:47</time><div class="article__meta__categories"><a class="article__meta__categories__item" href="/categories/PWN/">PWN</a><span class="article__meta__categories__separator">></span><a class="article__meta__categories__item" href="/categories/PWN/Theory/">Theory</a></div></div><hr><div class="article__contents"><h2 id="Segments"><a href="#Segments" class="headerlink" title="Segments"></a>Segments</h2><p>Segments usually describe the layout of <code>.elf</code> files in memory. In a C program the memory layout is as follows:</p>
<p><img src="/PWN/SegmentsandSections/memoryLayoutC.jpg" alt="Memory Layout"></p>
<p>So each the segments are different parts of the memory space e.g. Stack&#x2F;Heap. <strong>Note: uninitialized data (.bss) and initialized data (.data) should be regarded as a whole: data segment. They are sections by themselves.</strong> This memory layout is for virtual address. (visible to programmers). About the actually layout in physical memory, it is handled by OS using paging technique to mapping virtual address to physical address by page table. In a 32 bits OS, memory space for each process is 4GB (2^32). However 1 GB is preserved for OS kernel and shared between process, only about 3GB are exclusive for each process.</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=m1UzSfgjA4Y">Memory Segments</a></p>
<ul>
<li><p>Stack Segment:</p>
<p>Stack is preserved for local variables and function calls. It grows from high address to low address. The stack segment are exclusive for each thread for multi-threads programs (this is a special case because other segments are shared between threads).</p>
</li>
</ul>
<p><strong>Note: Between Stack and Heap there is a memory mapping segment used to store data of dynamic linked libraries.</strong></p>
<ul>
<li><p>Heap Segment:</p>
<p>Heap is dynamically allocated memory (malloc(), calloc()) and its lifetime is managed by user (use free() to deallocate). It grows form low address to high address.</p>
</li>
<li><p>Data Segment:</p>
<p>Data Segment has 2 sections: uninitialized data section (.bss) and initialized (.data) section.</p>
</li>
</ul>
<ol>
<li>.bss: It contains uninitialized static and global variables and they last during the whole lifetime of the program. These variables will be initialized as 0.</li>
<li>.data: It contains initialized static and global variables and they last during the whole lifetime of the program. The variables in this section can be constant if you added <code>const</code> specifier in initialization.</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> * text = <span class="string">&quot;Hello World&quot;</span>;  <span class="comment">// In this case, the variable text is constant </span></span><br><span class="line"><span class="type">int</span> val;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n%s\n&quot;</span>, val, text); <span class="comment">// val will be 0 here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Text Segment: It is also referred as code segment. It contains execution instructions for programs or const variables and its content cannot be modified during program execution. It is placed in the lower address so it will not be overwritten by heap or stack.</li>
</ul>
<h2 id="Sections"><a href="#Sections" class="headerlink" title="Sections"></a>Sections</h2><p>In contrast with segments, sections describe the layout of <code>.elf</code> files in disk. The most frequently used sections in PWN is .data and .bss as mentioned before. Now let’s analyze a demo program.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> global; <span class="comment">//.bss section</span></span><br><span class="line"><span class="type">char</span> * str = <span class="string">&quot;Hello World!&quot;</span>; <span class="comment">// .data section</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	sum(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">	<span class="type">void</span> * ptr = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">	read(<span class="number">0</span>, ptr, <span class="number">0x100</span>); <span class="comment">// input &quot;deadbeef&quot; here</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> ret = x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since <code>t</code> is the return value and <code>ptr</code> is local variable, they should be laid in stack segment. The heap segment stores the value <code>deadfeef</code> from the keyboard input. The <code>global</code> and <code>str</code> are both global variables. Since <code>global</code> is uninitialized variable, it should be initialized as 0 and stored in .bss section; and for <code>str</code>, since it is initialized, so it is stored in <code>.data</code> section. Both of them belongs to data segment. The text segment stores constant and instructions, so its content should be <code>main</code>, <code>sum</code> and <code>Hello World!</code>.</p>
<p>About <code>x</code> and <code>y</code>: its related with the CPU architecture. In x86 architecture, they should be stored in stack segment. In amd64, they are stored in registers.</p>
</div><div class="article__author" itemscope itemprop="author" itemtype="https://schema.org/Person"><img class="article__author__image" src="/images/avatar.jpg" alt="Benedict Ng"><a class="article__author__link" title="About Benedict Ng" rel="author">Benedict Ng</a><p class="article__author__desc">Social Media</p><div class="article__author__socials"><a class="article__author__socials__item" href="https://github.com/BenedictNgHK" title="github" target="_blank"><i class="fa fa-github"></i></a><a class="article__author__socials__item" href="https://www.facebook.com/BenedictNgYuzeWu" title="facebook" target="_blank"><i class="fa fa-facebook"></i></a><a class="article__author__socials__item" href="https://www.linkedin.com/in/yuze-wu-a100011ba" title="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></div><meta itemprop="name" content="Benedict Ng"></div><div class="sharer" id="sharer"><div class="sharer-inner"><div class="sharer__right"><button class="sharer__item" id="sharer-facebook"><i class="fa fa-facebook-official"></i></button><button class="sharer__item" id="sharer-twitter"><i class="fa fa-twitter"></i></button><button class="sharer__item" id="sharer-pinterest"><i class="fa fa-pinterest"></i></button><button class="sharer__item" id="sharer-pocket"><i class="fa fa-get-pocket"></i></button></div></div></div><!-- Disqus Code--><div id="disqus_thread"></div><script>(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://https-benedictnghk-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script><noscript>Enable JavaScript to see comments.</noscript><!-- Meta Tags for Structured Data--><meta itemprop="dateModified" content="2024-09-06T15:46:57.201Z"><meta itemprop="articleBody" content="SegmentsSegments usually describe the layout of .elf files in memory. In a C program the memory layout is as follows:

So each the segments are different parts of the memory space e.g...."><meta itemprop="url" content="https://benedictnghk.github.io/PWN/SegmentsandSections/"><meta itemprop="mainEntityOfPage" content="https://benedictnghk.github.io/PWN/SegmentsandSections/"><div itemscope itemtype="https://schema.org/Organization" itemprop="publisher"><meta itemprop="name" content="Benedict's Blog"><div itemscope itemprop="logo" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://benedictnghk.github.io/images/icon.png"></div></div><div itemscope itemtype="https://schema.org/ImageObject" itemprop="image"><meta itemprop="contentUrl" content="https://benedictnghk.github.io/images/default.jpg"><meta itemprop="url" content="https://benedictnghk.github.io/images/default.jpg"><meta itemprop="width" content="1280"><meta itemprop="height" content="720"></div></article><section class="related-posts"><h3>Related posts</h3><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/PWN/Assembly/"><div class="related-posts__item__background" style="background-image:url('/PWN/Assembly/rax.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">Assembly</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/PWN/Endianness/"><div class="related-posts__item__background" style="background-image:url('/PWN/Endianness/Endianess.png');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">Endianness</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/PWN/Shellcode/"><div class="related-posts__item__background" style="background-image:url('/images/default.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">Shellcode</span></a></div></section></div></div></div><footer id="footer"><div class="widgets"><div class="widgets-inner"><!-- Jade doesn't support dynamic inclusion with `each`.--><!-- So, I just hard coded the file names that will be included.--><div class="widgets__item"><h3 class="widgets__item__heading">Recent posts</h3><ul class="recent-posts"><li class="recent-posts__item"><a href="/Graphics/Pipeline/">Graphics Pipeline</a></li><li class="recent-posts__item"><a href="/OS/MemoryAlignment/">Memory Alignment</a></li><li class="recent-posts__item"><a href="/NumericalAnalysis/Errors/">Types of Error</a></li><li class="recent-posts__item"><a href="/PWN/IDA/">IDA Pro</a></li><li class="recent-posts__item"><a href="/PWN/SegmentsandSections/">Segments and Sections</a></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Categories</h3><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Graphics/">Graphics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Numerical-Analysis/">Numerical Analysis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Operation-System/">OS</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWN/">PWN</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PWN/Theory/">Theory</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWN/Tools/">Tools</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a><span class="category-list-count">1</span></li></ul></div></div></div><p class="copyright"><small>© 2024 Benedict Ng<br>Powered by <a href="https://hexo.io" rel="external" target="_blank">Hexo</a>, Theme by <a href="https://github.com/hyunseob" rel="external" target="_blank">HyunSeob</a></small></p></footer><!--[if lt IE 10]><script src="/js/classList.min.js"></script><![endif]--><script src="/js/index.min.js"></script></body></html>